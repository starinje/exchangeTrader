{"version":3,"sources":["../src/index.js"],"names":["info","geminiService","getOrderBook","orderBookGemini","gdaxService","orderBookGdax","orderBooks","gdax","gemini","determinePositionChange","positionChange","execute","tradeResults","gdaxResults","geminiResults","buyValue","sellValue","takeProfit","price","amount","fee","profit","action","delay","timeDelta","main","ethereumTradingQuantity","takeProfitTradeThreshold","swapFundsTradeThreshold","bidPriceGemini","calculateBidPrice","bids","bidPriceGdax","askPriceGemini","calculateAskPrice","asks","askPriceGdax","transactionPercentageGemini","transactionPercentageGdax","gdaxBasePercentageDifference","geminiBasePercentageDifference","gdaxRateIsHigherAndProfitable","geminiRateIsSwappable","estimatedTransactionFees","estimatedGrossProfit","estimatedNetProfit","totalSaleValue","totalPurchaseCost","quantity","units","rate","determineCurrentEthereumPosition","exchangeWithEthereumBalance","all","executeTrade","tradeLog","availableBalances","currentGeminiBalances","geminiUsdBalance","filter","accountDetails","currency","parseFloat","geminiEthBalance","currentGdaxBalances","gdaxUsdBalance","balance","gdaxEthBalance","ethereumBalance","logger","priceLevel","find","bid","ask"],"mappings":"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","file":"index.js","sourcesContent":["import fs from 'fs'\nimport autobahn from 'autobahn'\nimport program from 'commander'\nimport moment from 'moment'\nimport winston from 'winston'\nimport Promise from 'bluebird'\nimport request from 'request'\nimport rp from 'request-promise'\n\nimport config from './config'\n\nimport GdaxService from './services/gdax'\nimport GeminiService from './services/gemini'\nimport logger from './services/logger.js'\nimport heartbeatLogger from './services/heartbeatLogger.js'\n\nconst gdaxService = new GdaxService({...config.gdax, logger, })\nconst geminiService = new GeminiService({...config.gemini, logger})\n\nmain()\n\nasync function main(){\n\n  try {\n   \n    heartbeatLogger.info('running arbitrage strategy...')\n \n\n    let orderBookGemini = await geminiService.getOrderBook()\n    let orderBookGdax = await gdaxService.getOrderBook()\n\n    let orderBooks = {\n      gdax: orderBookGdax,\n      gemini: orderBookGemini\n    }\n\n    let positionChange = await determinePositionChange(orderBooks)\n\n    if(positionChange == 'none'){\n      return \n    }\n\n    logger.info('')\n    logger.info('NEW TRADE')\n    \n    let tradeResults = await execute(positionChange)\n\n    let gdaxResults = tradeResults.gdax\n    let geminiResults = tradeResults.gemini\n\n    //check here for results from each exchage. If either is bad then process.exit and cancel all orders on both exchanges.\n\n    let buyValue\n    let sellValue\n\n    switch(tradeResults.takeProfit){\n      case 'gdax':\n        buyValue = (tradeResults.gemini.price*tradeResults.gemini.amount) - tradeResults.gemini.fee\n        sellValue = (tradeResults.gdax.price*tradeResults.gdax.amount) - tradeResults.gdax.fee\n        break\n  \n      case 'gemini':\n        sellValue = (tradeResults.gemini.price*tradeResults.gemini.amount) - tradeResults.gemini.fee\n        buyValue = (tradeResults.gdax.price*tradeResults.gdax.amount) - tradeResults.gdax.fee\n        break\n    }\n    \n    let profit = (sellValue - buyValue) / buyValue\n    \n    logger.info(`successful ${tradeResults.gdax.action} on Gdax for ${tradeResults.gdax.amount} ethereum at $${tradeResults.gdax.price}/eth, fee of ${tradeResults.gdax.fee}`)\n    logger.info(`successful ${tradeResults.gemini.action} on Gemini for ${tradeResults.gemini.amount} ethereum at ${tradeResults.gemini.price}/eth, fee of ${tradeResults.gemini.fee}`)\n    logger.info(`profit percentage: ${profit}`)\n    \n  } catch(err){\n    logger.info(`error: ${err}`)\n    // geminiService.cancelOrders()\n    // gdaxService.cancelOrders()\n    // process.exit()\n  } finally{\n    await Promise.delay(config.timeDelta)\n    main()\n  }\n\n}\n\nasync function determinePositionChange(orderBooks){\n\n  const ethereumTradingQuantity = config.ethereumTradingQuantity\n  const takeProfitTradeThreshold = config.takeProfitTradeThreshold\n  const swapFundsTradeThreshold = config.swapFundsTradeThreshold\n\n  let bidPriceGemini = calculateBidPrice(orderBooks.gemini.bids, ethereumTradingQuantity)\n  let bidPriceGdax = calculateBidPrice(orderBooks.gdax.bids, ethereumTradingQuantity)\n  let askPriceGemini = calculateAskPrice(orderBooks.gemini.asks, ethereumTradingQuantity)\n  let askPriceGdax = calculateAskPrice(orderBooks.gdax.asks, ethereumTradingQuantity)\n\n  const transactionPercentageGemini = config.transactionPercentageGemini\n  const transactionPercentageGdax = config.transactionPercentageGdax\n\n  const gdaxBasePercentageDifference = ((bidPriceGdax - askPriceGemini)/askPriceGemini)*100\n  const geminiBasePercentageDifference = ((bidPriceGemini - askPriceGdax)/askPriceGdax)*100\n\n  const gdaxRateIsHigherAndProfitable = gdaxBasePercentageDifference > takeProfitTradeThreshold\n  const geminiRateIsSwappable = geminiBasePercentageDifference > swapFundsTradeThreshold\n\n  let positionChange\n  let estimatedTransactionFees\n  let estimatedGrossProfit\n  let estimatedNetProfit\n\n  heartbeatLogger.info(`bidPriceGemini: ${bidPriceGemini}`)\n  heartbeatLogger.info(`bidPriceGdax: ${bidPriceGdax}`)\n  heartbeatLogger.info(`askPriceGemini: ${askPriceGemini}`)\n  heartbeatLogger.info(`askPriceGdax: ${askPriceGdax}`)\n\n  heartbeatLogger.info(`gdaxBasePercentageDifference: ${gdaxBasePercentageDifference}`)\n  heartbeatLogger.info(`geminiBasePercentageDifference: ${geminiBasePercentageDifference}`)\n\n\n  if(gdaxRateIsHigherAndProfitable){\n\n    logger.info(`bidPriceGemini: ${bidPriceGemini}`)\n    logger.info(`bidPriceGdax: ${bidPriceGdax}`)\n    logger.info(`askPriceGemini: ${askPriceGemini}`)\n    logger.info(`askPriceGdax: ${askPriceGdax}`)\n\n    logger.info(`gdaxBasePercentageDifference: ${gdaxBasePercentageDifference}`)\n    logger.info(`geminiBasePercentageDifference: ${geminiBasePercentageDifference}`)\n\n    logger.info('gdax rate is higher and profitable')\n\n    let totalSaleValue = bidPriceGdax*ethereumTradingQuantity\n    let totalPurchaseCost = askPriceGemini*ethereumTradingQuantity\n    estimatedGrossProfit = totalSaleValue-totalPurchaseCost\n    estimatedTransactionFees = ((transactionPercentageGdax/100)*totalSaleValue) + ((transactionPercentageGemini/100)*totalPurchaseCost)\n    estimatedNetProfit = estimatedGrossProfit - estimatedTransactionFees\n    \n    logger.info(`estimated total sale value: ${totalSaleValue}`)\n    logger.info(`estimated total purchase cost: ${totalPurchaseCost}`)\n    logger.info(`estimated gross profit: ${estimatedGrossProfit}`)\n    logger.info(`estimated transaction fees: ${estimatedTransactionFees}`)\n    logger.info(`estimated net profit: ${estimatedNetProfit}`)\n\n    positionChange = {\n      takeProfit: 'gdax',\n      gdax : {\n        action: 'sell',\n        quantity: ethereumTradingQuantity,\n        units: 'eth',\n        rate: bidPriceGdax\n      },\n      gemini: {\n        action: 'buy',\n        quantity: ethereumTradingQuantity,\n        units: 'eth',\n        rate: askPriceGemini\n      }\n    }\n  } else if (geminiRateIsSwappable) {\n    logger.info(`bidPriceGemini: ${bidPriceGemini}`)\n    logger.info(`bidPriceGdax: ${bidPriceGdax}`)\n    logger.info(`askPriceGemini: ${askPriceGemini}`)\n    logger.info(`askPriceGdax: ${askPriceGdax}`)\n\n    logger.info(`gdaxBasePercentageDifference: ${gdaxBasePercentageDifference}`)\n    logger.info(`geminiBasePercentageDifference: ${geminiBasePercentageDifference}`)\n    logger.info('Gemini rate is higher and profitable')\n\n    let totalSaleValue = bidPriceGemini*ethereumTradingQuantity\n    let totalPurchaseCost = askPriceGdax*ethereumTradingQuantity\n    estimatedGrossProfit = totalSaleValue-totalPurchaseCost\n    estimatedTransactionFees = ((transactionPercentageGemini/100)*totalSaleValue) + ((transactionPercentageGdax/100)*totalPurchaseCost)\n    estimatedNetProfit = estimatedGrossProfit - estimatedTransactionFees\n    \n    logger.info(`estimated total sale value: ${totalSaleValue}`)\n    logger.info(`estimated total purchase cost: ${totalPurchaseCost}`)\n    logger.info(`estimated gross profit: ${estimatedGrossProfit}`)\n    logger.info(`estimated transaction fees: ${estimatedTransactionFees}`)\n    logger.info(`estimated net profit: ${estimatedNetProfit}`)\n\n    positionChange= {\n      takeProfit: 'gemini',\n      gemini: {\n        action: 'sell',\n        quantity: ethereumTradingQuantity,\n        units: 'eth',\n        rate: bidPriceGemini\n      },\n      gdax : {\n        action: 'buy',\n        quantity: ethereumTradingQuantity,\n        units: 'eth',\n        rate: askPriceGdax\n      }\n    }\n  } else {\n    positionChange = 'none'\n    return positionChange\n  }\n\n  let exchangeWithEthereumBalance = await determineCurrentEthereumPosition()\n\n  if(positionChange[exchangeWithEthereumBalance].action == 'sell'){\n    return positionChange\n  } else {\n    return 'none'\n  }\n}\n\nasync function execute(positionChange){\n\n  let tradeResults = await Promise.all([gdaxService.executeTrade(positionChange), geminiService.executeTrade(positionChange)])\n  //let tradeResults = await Promise.all([gdaxService.executeTrade(positionChange)])\n\n  let tradeLog = {\n    gdax: tradeResults[0],\n    gemini: tradeResults[1],\n    takeProfit: positionChange.takeProfit\n  }\n\n  return tradeLog\n}\n\nasync function determineCurrentEthereumPosition(){\n\n  // determine gemini ethereum balance\n  let currentGeminiBalances = await geminiService.availableBalances()\n  \n  let geminiUsdBalance = currentGeminiBalances.filter(accountDetails => accountDetails.currency == 'USD')\n  geminiUsdBalance = parseFloat(geminiUsdBalance[0].amount)\n\n  let geminiEthBalance = currentGeminiBalances.filter(accountDetails => accountDetails.currency == 'ETH')\n  geminiEthBalance = parseFloat(geminiEthBalance[0].amount)\n\n  // determine gdax ethereum balance\n  let currentGdaxBalances = await gdaxService.availableBalances()\n  \n  let gdaxUsdBalance = currentGdaxBalances.filter((accountDetails) => accountDetails.currency == 'USD')\n  gdaxUsdBalance = parseFloat(gdaxUsdBalance[0].balance)\n\n  let gdaxEthBalance = currentGdaxBalances.filter((accountDetails) => accountDetails.currency == 'ETH')\n  gdaxEthBalance = parseFloat(gdaxEthBalance[0].balance)\n\n  logger.info(`geminiEthBalance: ${geminiEthBalance}`)\n  logger.info(`geminiUsdBalance: ${geminiUsdBalance}`)\n  logger.info(`gdaxEthBalance: ${gdaxEthBalance}`)\n  logger.info(`gdaxUsdBalance: ${gdaxUsdBalance}`)\n\n  let ethereumBalance\n  if(geminiEthBalance > gdaxEthBalance){\n    ethereumBalance = 'gemini'\n  } else if (gdaxEthBalance > geminiEthBalance){\n    ethereumBalance = 'gdax'\n  }\n\n  logger.info(`ethereum balance is in ${ethereumBalance}`)\n\n  return ethereumBalance\n}\n\nfunction calculateBidPrice(bids, ethereumTradingQuantity){\n\n  let priceLevel = bids.find((bid) => {\n    return parseFloat(bid.amount) >= ethereumTradingQuantity\n  })\n  //let priceLevel = bids[0]\n\n  return priceLevel ? parseFloat(priceLevel.price) : 'no match found'\n}\n\nfunction calculateAskPrice(asks, ethereumTradingQuantity){\n\n  let priceLevel = asks.find((ask) => {\n    return parseFloat(ask.amount) >= ethereumTradingQuantity\n  })\n  //let priceLevel = asks[0]\n\n  return priceLevel ? parseFloat(priceLevel.price) : 'no match found'\n}\n\n"]}