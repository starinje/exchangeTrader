{"version":3,"sources":["../src/index.js"],"names":["console","log","logger","info","geminiService","getOrderBook","orderBookGemini","gdaxService","orderBookGdax","orderBooks","gdax","gemini","determinePositionChange","positionChange","execute","results","delay","timeDelta","main","ethereumTradingQuantity","takeProfitTradeThreshold","swapFundsTradeThreshold","bidPriceGemini","calculateBidPrice","bids","bidPriceGdax","askPriceGemini","calculateAskPrice","asks","askPriceGdax","transactionPercentageGemini","transactionPercentageGdax","gdaxBasePercentageDifference","geminiBasePercentageDifference","gdaxRateIsHigherAndProfitable","geminiRateIsSwappable","estimatedTransactionFees","estimatedGrossProfit","estimatedNetProfit","totalSaleValue","totalPurchaseCost","type","action","quantity","units","rate","determineCurrentEthereumPosition","exchangeWithEthereumBalance","all","executeTrade","tradeResults","tradeLog","availableBalances","currentGeminiBalances","JSON","stringify","TIMESTAMP_FORMAT","Logger","add","transports","Console","timestamp","utc","format","colorize","prettyPrint","level","process","env","NODE_ENV","aggregateProfit","priceLevel","find","bid","parseFloat","amount","price","ask"],"mappings":"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","file":"index.js","sourcesContent":["import fs from 'fs'\nimport autobahn from 'autobahn'\nimport program from 'commander'\nimport moment from 'moment'\nimport winston from 'winston'\nimport Promise from 'bluebird'\nimport request from 'request'\nimport rp from 'request-promise'\n\nimport config from './config'\n\nimport GdaxService from './services/gdax'\nimport GeminiService from './services/gemini'\n\nconst TIMESTAMP_FORMAT = 'HH:mm:ss.SSS'\n\n// Initialize logger\nconst logger = new winston.Logger().add(winston.transports.Console, {\n    timestamp: () => `[${moment.utc().format(TIMESTAMP_FORMAT)}]`,\n    colorize: true,\n    prettyPrint: true,\n    level: process.env.NODE_ENV === 'production' ? 'info' : 'debug',\n})\n\nconst gdaxService = new GdaxService({...config.gdax, logger, })\nconst geminiService = new GeminiService({...config.gemini, logger})\n\nlet aggregateProfit = 0\n\nmain()\n\nasync function main(){\n\n  try {\n    console.log('')\n    console.log('')\n    logger.info('running arbitrage strategy...')\n\n    let orderBookGemini = await geminiService.getOrderBook()\n    let orderBookGdax = await gdaxService.getOrderBook()\n\n    let orderBooks = {\n      gdax: orderBookGdax,\n      gemini: orderBookGemini\n    }\n\n    let positionChange = await determinePositionChange(orderBooks)\n\n    if(positionChange == 'none'){\n      return \n    }\n    \n    let results = await execute(positionChange)\n    \n  } catch(err){\n    logger.info(`error: ${err}`)\n  } finally{\n    await Promise.delay(config.timeDelta)\n    main()\n  }\n\n}\n\nasync function determinePositionChange(orderBooks){\n\n  const ethereumTradingQuantity = config.ethereumTradingQuantity\n  const takeProfitTradeThreshold = config.takeProfitTradeThreshold\n  const swapFundsTradeThreshold = config.swapFundsTradeThreshold\n\n  let bidPriceGemini = calculateBidPrice(orderBooks.gemini.bids, ethereumTradingQuantity)\n  let bidPriceGdax = calculateBidPrice(orderBooks.gdax.bids, ethereumTradingQuantity)\n  let askPriceGemini = calculateAskPrice(orderBooks.gemini.asks, ethereumTradingQuantity)\n  let askPriceGdax = calculateAskPrice(orderBooks.gdax.asks, ethereumTradingQuantity)\n\n  logger.info(`bidPriceGemini: ${bidPriceGemini}`)\n  logger.info(`bidPriceGdax: ${bidPriceGdax}`)\n  logger.info(`askPriceGemini: ${askPriceGemini}`)\n  logger.info(`askPriceGdax: ${askPriceGdax}`)\n\n  const transactionPercentageGemini = config.transactionPercentageGemini\n  const transactionPercentageGdax = config.transactionPercentageGdax\n\n  const gdaxBasePercentageDifference = ((bidPriceGdax - askPriceGemini)/askPriceGemini)*100\n  const geminiBasePercentageDifference = ((bidPriceGemini - askPriceGdax)/askPriceGdax)*100\n\n  const gdaxRateIsHigherAndProfitable = gdaxBasePercentageDifference > takeProfitTradeThreshold\n  const geminiRateIsSwappable = geminiBasePercentageDifference > swapFundsTradeThreshold\n\n  let positionChange\n  let estimatedTransactionFees\n  let estimatedGrossProfit\n  let estimatedNetProfit\n\n  logger.info(`gdaxBasePercentageDifference: ${gdaxBasePercentageDifference}`)\n  logger.info(`geminiBasePercentageDifference: ${geminiBasePercentageDifference}`)\n\n  if(gdaxRateIsHigherAndProfitable){\n    logger.info('gdax rate is higher and profitable')\n\n    let totalSaleValue = bidPriceGdax*ethereumTradingQuantity\n    let totalPurchaseCost = askPriceGemini*ethereumTradingQuantity\n    estimatedGrossProfit = totalSaleValue-totalPurchaseCost\n    estimatedTransactionFees = ((transactionPercentageGdax/100)*totalSaleValue) + ((transactionPercentageGemini/100)*totalPurchaseCost)\n    estimatedNetProfit = estimatedGrossProfit - estimatedTransactionFees\n    \n    logger.info(`estimated total sale value: ${totalSaleValue}`)\n    logger.info(`estimated total purchase cost: ${totalPurchaseCost}`)\n    logger.info(`estimated gross profit: ${estimatedGrossProfit}`)\n    logger.info(`estimated transaction fees: ${estimatedTransactionFees}`)\n    logger.info(`estimated net profit: ${estimatedNetProfit}`)\n\n    positionChange = {\n      type: 'takeProfit',\n      gdax : {\n        action: 'sell',\n        quantity: ethereumTradingQuantity,\n        units: 'eth',\n        rate: bidPriceGdax\n      },\n      gemini: {\n        action: 'buy',\n        quantity: ethereumTradingQuantity,\n        units: 'eth',\n        rate: askPriceGemini\n      }\n    }\n  } else if (geminiRateIsSwappable) {\n    logger.info('Gemini Rate Is Swappable')\n\n    let totalSaleValue = bidPriceGemini*ethereumTradingQuantity\n    let totalPurchaseCost = askPriceGdax*ethereumTradingQuantity\n    estimatedGrossProfit = totalSaleValue-totalPurchaseCost\n    estimatedTransactionFees = ((transactionPercentageGemini/100)*totalSaleValue) + ((transactionPercentageGdax/100)*totalPurchaseCost)\n    estimatedNetProfit = estimatedGrossProfit - estimatedTransactionFees\n    \n    logger.info(`estimated total sale value: ${totalSaleValue}`)\n    logger.info(`estimated total purchase cost: ${totalPurchaseCost}`)\n    logger.info(`estimated gross profit: ${estimatedGrossProfit}`)\n    logger.info(`estimated transaction fees: ${estimatedTransactionFees}`)\n    logger.info(`estimated net profit: ${estimatedNetProfit}`)\n\n    positionChange= {\n      type: 'swapFunds',\n      gemini: {\n        action: 'sell',\n        quantity: ethereumTradingQuantity,\n        units: 'eth',\n        rate: bidPriceGemini\n      },\n      gdax : {\n        action: 'buy',\n        quantity: ethereumTradingQuantity,\n        units: 'eth',\n        rate: askPriceGdax\n      }\n    }\n  } else {\n    positionChange = 'none'\n    return positionChange\n  }\n\n  let exchangeWithEthereumBalance = await determineCurrentEthereumPosition()\n  \n  if(positionChange[exchangeWithEthereumBalance].action == 'sell'){\n    return positionChange\n  } else {\n    return 'none'\n  }\n}\n\nasync function execute(positionChange){\n\n  let tradeResults = await Promise.all([gdaxService.executeTrade(positionChange.gdax), geminiService.executeTrade(positionChange.gemini)])\n\n  let tradeLog = {\n    ...tradeResults,\n    type: positionChange.type\n  }\n  \n  return tradeLog\n}\n\nasync function determineCurrentEthereumPosition(){\n\n\n  let currentGeminiBalances = await geminiService.availableBalances()\n  logger.info(`current Gemini Balances: ${JSON.stringify(currentGeminiBalances)}`)\n\n\n  //let currentGdaxBalances = await gdaxService.getMyAvailableBalances()\n  //console.log(`current Gdax Balances: ${currentGdaxBalances}`)\n\n  // check balances on both exchanges\n  // return name of exchange with ethereum balance (account to sell from)\n  return 'gdax'\n\n}\n\nfunction calculateBidPrice(bids, ethereumTradingQuantity){\n\n  let priceLevel = bids.find((bid) => {\n    return parseFloat(bid.amount) >= ethereumTradingQuantity\n  })\n\n  return priceLevel ? parseFloat(priceLevel.price) : 'no match found'\n}\n\nfunction calculateAskPrice(asks, ethereumTradingQuantity){\n\n  let priceLevel = asks.find((ask) => {\n    return parseFloat(ask.amount) >= ethereumTradingQuantity\n  })\n\n  return priceLevel ? parseFloat(priceLevel.price) : 'no match found'\n}\n\n"]}